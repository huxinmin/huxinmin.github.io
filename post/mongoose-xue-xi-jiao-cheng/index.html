<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢"/>
<meta name="keywords" content="ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://huxinmin.github.io/favicon.ico">

<link rel="stylesheet" href="https://huxinmin.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://huxinmin.github.io/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://huxinmin.github.io/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://huxinmin.github.io/images/avatar.png" alt="ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢"
                 class="img-responsive">
        </figure>
        <a href="https://huxinmin.github.io/post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢</h2>
        <p>ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢</p>
        <ul class="fh5co-social">
            
                <li>
                    
                        <a href="https://github.com/huxinmin" target="_blank">
                            <i class="fab fa-github"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                        <a href="https://www.zhihu.com/people/hu-xin-min-99" target="_blank">
                            <i class="fab fa-zhihu"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- Ê†áÁ≠æ -->
        <div class="fh5co-box">
            <a href="https://huxinmin.github.io/tags/"><h3 class="heading">üëâÊ†áÁ≠æ</h3></a>
            <ul>
                
                    <li><a href="https://huxinmin.github.io/tag/mSeB0wbbH/">linux</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/0CEgc5Nuc/">react</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/AzH6zVqFK/">js</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/UJq-iLfq6/">restful</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/r0zynGCMV/">http</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/GNbObqsVG/">json</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/dZU9srOJ4/">moment.js</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/wsD4ABEPz/">Êï∞ÊçÆÂ∫ì</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/tq8jF2xcA/">mongoose</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/VL5yScL71/">mongodb</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/XRK7arMJO/">nodejs</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/DJMLUSVfi/">html5</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/oHlYLx_Tl/">websocket</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/8-tAS0eFO/">nginx</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/X3jlBk5nJ/">css</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/H8XsrzQ7e/">css3</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/J27JVlP2F/">Êñá‰ª∂‰∏ä‰º†</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/X3Z7s8kF_/">jquery</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/CrwH886ky/">ajax</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/s0bxFP3uF/">express</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/38jtWMHZL/">as</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ZSDYSDwY2/">ÂÖ∂‰ªñ</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/GhuJji1q_/">ÊµãËØï</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/4OX23_HC0/">jest</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/dlMKptzLv/">ÁºñËæëÂô®</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/JavlGTiRY/">editorconfig</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/hK_EE8fK-/">html</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/8ARTmIQjv/">karma</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Efegfi1Q0/">jasmine</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/tvb1JT8Vl/">mocha</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/9HFOidQXy/">chai</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/siBe4eLq2/">shoudjs</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/82-zkoYE7/">phantomjs</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Yn33g0TTY/">protracor</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/JEoE22ARw/">scp</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ZobAApfEI/">Êó∂Èó¥</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/p-1jKuK3s/">shell</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/o2F0RWP7Z/">expect</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/oZPL-E1ZP/">android</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/J3VGgpXs3/">cordova</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/hMVcUsgPS/">ssh</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/R2oW4iPeR/">travis</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/3v5vwBmB7/">ÊåÅÁª≠ÈõÜÊàê</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/wal-ORU6g/">debug</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/nDFAAzmpuR/">Ë∞ÉËØï</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ev9_gzvje/">eslint</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ntzw3iLKX/">cËØ≠Ë®Ä</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/pTofQIx8N/">ÂæÖÂäû‰∫ãÂÆú</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/8u7cjaUBn/">ÈöèÁ¨î</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/JxrnYwde_/">rxjs</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/_TCq2VBQY/">ionic</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ISScirFbw/">hybird</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/I2qOLVgn5/">java</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/l3EUiIS45/">jdk</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/4JSZ2fIFF/">commander</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/KPcAAJVPD/">cli</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/HOjS4qCUx/">npm</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/lqFA57swl/">webpack</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/saP-vOeLO/">flex</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/2w4zWQ1rD/">modernizr</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/ZFB8USksG/">fetch</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/HcGdqo85L/">Èù¢ËØï</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/maCy0gm-G/">kindle</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/m_CeLo5Yt/">‰π¶Á±ç</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/6rUJXYvms/">crontab</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Sy1VSsLCc/">less</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/rkzXit3IP/">calc</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/02zgiNEsk/">chmod</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Y3JItHzej/">Ê≠£Âàô</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/-rUjtgnqY/">markdown</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/7cRU4Rk01/">shadowsocks</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Lcnh0Kloq/">rar</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/6LfZ0TlHm/">chrome</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/2_ru1bd6V/">ÊµèËßàÂô®</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/v4XDvkty0/">svg-captcha</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/IfZJdWPEH4/">È™åËØÅÁ†Å</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/dTR2pztpH/">github</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/knySerdH-/">git</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/NSyjPJZkv/">aws</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/pU8c2aJR5/">webassembly</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Y9WXm0Dq5/">csrf</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/qL6pz1TS3V/">ÁΩëÁªúÂÆâÂÖ®</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/4iG18Qwl3/">sshd</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/OJtK_Dsle/">certbot</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/IFH5mQ48qH/">https</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/d2mdgi3zW/">sitemap</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/UsaB01y9b/">sublime</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/oVWhBDgSF/">centos</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/Q6D25qRLv/">ÂüüÂêç</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/apvJi9fD0/">linqjs</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/3ZKlDJ0kL/">psftp</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/XATUWlxdty/">Êñá‰ª∂‰º†Ëæì</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/JqHVZntTk/">putty</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/aM2YKZNfZ/">excel</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/75lp1XTT6/">cnpm</a></li>
                
                    <li><a href="https://huxinmin.github.io/tag/eFtdyA4Ic/">ÂèçÂêë‰ª£ÁêÜ</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            È¶ñÈ°µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            ÂΩíÊ°£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            Ê†áÁ≠æ
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            ÂÖ≥‰∫é
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://huxinmin.github.io">ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢ </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>üëà Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next üëâ</span></a>-->

    <!-- Á≠âgrideaÂá∫Ëá™ÂÆö‰πâÈ°µÈù¢ÂäüËÉΩÂÜç‰ºòÂåñ‰∏Ä‰∏ã -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://huxinmin.github.io/post-images/mongoose-xue-xi-jiao-cheng.png" alt="mongooseÂ≠¶‰π†ÊïôÁ®ã" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://huxinmin.github.io/tag/wsD4ABEPz/" class="tag">Êï∞ÊçÆÂ∫ì, </a>
                        
                            <a href="https://huxinmin.github.io/tag/tq8jF2xcA/" class="tag">mongoose, </a>
                        
                            <a href="https://huxinmin.github.io/tag/VL5yScL71/" class="tag">mongodb, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">mongooseÂ≠¶‰π†ÊïôÁ®ã</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2020-04-20</li>
                <li>5130Â≠ó</li>
                <li>25 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <h2 id="why-mongoose">why mongoose?</h2>
<p>Âú®ÂÆòÁΩë‰∏äÊòØËøôÊ†∑ËØ¥ÁöÑÔºåÊàë‰ª¨ÂºÄÂèëMongooseÊòØÂõ†‰∏∫ÔºàÂºÄÂèëËÄÖÔºâÂÜôMongoDBÁöÑÈ™åËØÅÊú∫Âà∂„ÄÅÁ±ªÂûãËΩ¨Êç¢‰∏é‰∏öÂä°ÈÄªËæëÊ®°ÊùøÂæàÈ∫ªÁÉ¶„ÄÇ ÈíàÂØπ‰∏∫Â∫îÁî®Êï∞ÊçÆÂª∫Ê®°ÁöÑÈóÆÈ¢òÔºåMongoose Êèê‰æõ‰∫Ü‰∏ÄÂ•óÁõ¥ÁôΩÁöÑÔºåÂü∫‰∫éÊ®°ÂºèÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇÂåÖÊã¨‰∫ÜÂÜÖÂª∫ÁöÑÁ±ªÂûãËΩ¨Êç¢„ÄÅÈ™åËØÅÂô®„ÄÅÊü•ËØ¢ÊûÑÈÄ†Âô®„ÄÅ‰∏öÂä°ÈÄªËæëÈí©Â≠êÁ≠â„ÄÇ</p>
<h2 id="ÁÆÄ‰ªã">ÁÆÄ‰ªã</h2>
<p>mongooseÊòØmongoDBÁöÑ‰∏Ä‰∏™ÂØπË±°Ê®°ÂûãÂ∑•ÂÖ∑ÔºåÊòØÂü∫‰∫é<code>node-mongodb-native</code>ÂºÄÂèëÁöÑmongoDBÁöÑnodejsÈ©±Âä®ÔºåÂèØ‰ª•Âú®ÂºÇÊ≠•ÁöÑÁéØÂ¢É‰∏ãÊâßË°å„ÄÇÂêåÊó∂ÂÆÉ‰πüÊòØÈíàÂØπmongoDBÊìç‰ΩúÁöÑ‰∏Ä‰∏™ÂØπË±°Ê®°ÂûãÂ∫ìÔºåÂ∞ÅË£Ö‰∫ÜmongoDBÂØπÊñáÊ°£ÁöÑ‰∏Ä‰∫õÂ¢ûÂà†ÊîπÊü•Á≠âÂ∏∏Áî®ÊñπÊ≥ïÔºåËÆ©nodejsÊìç‰ΩúmongoDBÊï∞ÊçÆÂ∫ìÂèòÂæóÊõ¥Âä†ÂÆπÊòì„ÄÇ</p>
<h2 id="ÂÆâË£Ö">ÂÆâË£Ö</h2>
<p>Âú®ÂÆâË£Ömongoose‰πãÂâçÊàë‰ª¨ÈúÄË¶ÅÂÆâË£Ö<code>mongodb</code>Âíå<code>nodejs</code>ÔºåÁÑ∂Âêé</p>
<pre><code class="language-sh">npm install mongoose
</code></pre>
<p>ÁÑ∂ÂêéÂºÄÂßãÂª∫Á´ãËøûÊé•Âπ∂‰ΩøÁî®Âç≥ÂèØÔºö</p>
<pre><code class="language-js">var mongoose = require('mongoose');
mongoose.connect('mongodb://user:pass@localhost:port/database',options);
var conn = mongoose.connection;
conn.on('connected', callback); //ËøûÊé•ÊàêÂäü
conn.on('disconnected', callback); //Êñ≠ÂºÄËøûÊé•
conn.on('connecting', callback); //ËøûÊé•‰∏≠
conn.on('disconnecting', callback); //Êñ≠ÂºÄËøûÊé•‰∏≠
conn.on('error', callback); //ËøûÊé•ÂºÇÂ∏∏
</code></pre>
<h2 id="schemas">Schemas</h2>
<p>mongoose‰∏≠ÁöÑschemaÂØπÂ∫î‰∫émongodb‰∏≠ÁöÑcollectionÔºåÂπ∂‰∏îÂÆö‰πâ‰∫ÜËøô‰∏™ÊñáÊ°£ÈáåÈù¢ÁöÑÊï∞ÊçÆÊ®°Âûã„ÄÇ</p>
<pre><code class="language-js"> var mongoose = require('mongoose');
  var Schema = mongoose.Schema;
  var blogSchema = new Schema({
    title:  String,
    author: String,
    body:   String,
    comments: [{ body: String, date: Date }],
    date: { type: Date, default: Date.now },
    hidden: Boolean,
    meta: {
      votes: Number,
      favs:  Number
    }
  });
//Â¶ÇÊûúÊÉ≥Âú®ÂêéÊúüÂä†ÂÖ•Âà´ÁöÑÊï∞ÊçÆÊ®°Âûã
blogSchema.add({ name: 'string', color: 'string', price: 'number' });
</code></pre>
<p>Âú®ÂÆö‰πâÊï∞ÊçÆÊ®°ÂûãÁöÑÊó∂ÂÄôÔºåÊÇ®ÈúÄË¶ÅÊåáÂÆöÊØè‰∏™Â≠óÊÆµÂØπÂ∫îÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåmongooseÊîØÊåÅ‰ª•‰∏ãËøô‰∫õÁ±ªÂûãÔºö</p>
<ul>
<li><code>String</code></li>
<li><code>Number</code></li>
<li><code>Date</code></li>
<li><code>Buffer</code></li>
<li><code>Boolean</code></li>
<li><code>Mixed</code></li>
<li><code>ObjectId</code></li>
<li><code>Array</code></li>
<li><code>Decimal128</code></li>
<li><code>Map</code></li>
</ul>
<p>ÊÇ®ÂèØ‰ª•Áõ¥Êé•ÊåáÂÆöÊï∞ÊçÆÁöÑÁ±ªÂûãÔºåËøòÂèØ‰ª•Âú®ÊåáÂÆöÁ±ªÂûãÁöÑÂêåÊó∂ÔºåËÆæÁΩÆ‰∏Ä‰∫õÈÄâÈ°πÔºö</p>
<pre><code class="language-js">var schema1 = new Schema({
  test: String
});
var schema2 = new Schema({
  test: { 
     type: String,
     lowercase: true  //ËØ•ÈÄâÈ°πÂè™ÊîØÊåÅstringÁ±ªÂûã
  }
});
</code></pre>
<p>ÂÖ¨ÂÖ±ÈÄâÈ°πÂàóË°®Â¶Ç‰∏ãÔºö</p>
<ul>
<li><code>required</code>ÊòØÂê¶ÊòØÂøÖÈ°ªÂ°´ÂÜôÁöÑ</li>
<li><code>default</code>ÈªòËÆ§ÂÄºÔºåÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÂÄºÊàñËÄÖ‰∏Ä‰∏™Â∏¶ËøîÂõûÂÄºÁöÑÂáΩÊï∞</li>
<li><code>select</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶ÂêØÁî®MongodbÁöÑ<a href="https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/" target="_blank" rel="nofollow"><code>projection</code></a>ÂäüËÉΩ</li>
<li><code>validate</code>ÂáΩÊï∞ÔºåÊ∑ªÂä†È™åËØÅÂô®</li>
<li><code>get</code>Ê∑ªÂä†getterÂáΩÊï∞</li>
<li><code>set</code>Ê∑ªÂä†setterÂáΩÊï∞</li>
<li><code>alias</code>Â≠óÁ¨¶Á±ªÂûãÔºåÂÆö‰πâ‰∏Ä‰∏™<code>virtual</code><br>
Â∫èÂàóÈÄâÈ°πÂàóË°®Â¶Ç‰∏ãÔºö</li>
<li><code>index</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶‰∏∫ËØ•ÈîÆÂª∫Á´ã<a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="nofollow">Â∫èÂàó</a></li>
<li><code>unique</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶Âª∫ËÆÆ<a href="https://docs.mongodb.com/manual/core/index-unique/" target="_blank" rel="nofollow">ÂîØ‰∏ÄÂ∫èÂàó</a></li>
<li><code>sparse</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶Âª∫Á´ã<a href="https://docs.mongodb.com/manual/core/index-sparse/" target="_blank" rel="nofollow">Á®ÄÁñèÂ∫èÂàó</a><br>
Â≠óÁ¨¶‰∏≤ÈÄâÈ°πÂàóË°®Â¶Ç‰∏ãÔºö</li>
<li><code>lowercase</code>Â∏ÉÂ∞îÂÄºÔºåËΩ¨Êç¢‰∏∫Â∞èÂÜô</li>
<li><code>uppercase</code>Â∏ÉÂ∞îÂÄºÔºåËΩ¨Êç¢‰∏∫Â§ßÂÜô</li>
<li><code>trim</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶‰ΩøÁî®<code>trim()</code>ÊñπÊ≥ïÊ∂àÈô§Á©∫ÁôΩ</li>
<li><code>match</code>Ê≠£ÂàôÔºåÊ£ÄÊü•ÊòØÂê¶ÂåπÈÖç</li>
<li><code>enum</code>Êï∞ÁªÑÔºåÊ£ÄÊµãÊòØÂê¶Âú®Êï∞ÁªÑ‰∏≠</li>
<li><code>minlength</code>ÊúÄÂ∞èÈïøÂ∫¶</li>
<li><code>maxlength</code>ÊúÄÂ§ßÈïøÂ∫¶</li>
</ul>
<p>Ê≥®ÊÑèÁöÑÁÇπÔºö</p>
<ul>
<li>ÂÜÖÁΩÆÁöÑjsÁöÑDateÊñπÊ≥ïÊîπÂèòmongooseÁöÑdateÁ±ªÂûãÊï∞ÊçÆÊó∂Ôºå‰øùÂ≠òÊó∂Êó†ÊïàÔºåÂøÖÈ°ªÂÖàË∞ÉÁî®<code>markModified</code>ÊñπÊ≥ï</li>
</ul>
<pre><code class="language-js">var Assignment = mongoose.model('Assignment', { dueDate: Date });
Assignment.findOne(function (err, doc) {
  doc.dueDate.setMonth(3);
  doc.save(callback); // Êó†Êïà
  doc.markModified('dueDate');
  doc.save(callback); // ÊúâÊïà
})
</code></pre>
<ul>
<li>mixedÁ±ªÂûãÁöÑÊï∞ÊçÆÁ±ªÂûãÂ¶ÇÊûúÂÄºÊîπÂèòÔºå‰πüÈúÄË¶ÅÂÖàË∞ÉÁî®<code>markModified</code>ÊñπÊ≥ï</li>
</ul>
<pre><code class="language-js">person.anything = { x: [3, 4, { y: &quot;changed&quot; }] };
person.markModified('anything');
person.save();
</code></pre>
<ul>
<li>ÂÖ∑ÂåñObjectIdÁöÑÊó∂ÂÄôÈúÄË¶Å‰ΩøÁî®<code>Schema.Types.ObjectId</code></li>
</ul>
<pre><code class="language-js">var ObjectId = mongoose.Schema.Types.ObjectId;
var Car = new Schema({ driver: ObjectId });
</code></pre>
<ul>
<li>mapÁ±ªÂûãÁöÑÊï∞ÊçÆÈúÄË¶Å<code>get()</code>Âíå<code>set()</code>Êù•ÂèñÂÄºÂíåËÆæÁΩÆÂÄº</li>
</ul>
<pre><code class="language-js">const user = new User({
  socialMediaHandles: {}
});
user.socialMediaHandles.set('github', 'vkarpov15');
user.set('socialMediaHandles.twitter', '@code_barbarian');
console.log(user.socialMediaHandles.get('github'));
console.log(user.get('socialMediaHandles.twitter'));
</code></pre>
<ul>
<li><code>schema.path()</code>ÂèØ‰ª•Ëé∑ÂæóÂÆû‰æãÂåñÁöÑschemaÁöÑÁ±ªÂûã</li>
</ul>
<pre><code class="language-js">var sampleSchema = new Schema({ name: { type: String, required: true } });
console.log(sampleSchema.path('name'));
// ËæìÂá∫Â¶Ç‰∏ã:
/**
 * SchemaString {
 *   enumValues: [],
 *   regExp: null,
 *   path: 'name',
 *   instance: 'String',
 *   validators: ...
 */
</code></pre>
<p>Êàë‰ª¨ÂèØ‰ª•Âú®schema‰∏äÂÆö‰πâ‰∏Ä‰∫õ<code>methods</code>ÔºåËØ•ÊñπÊ≥ïÂèØ‰ª•Âú®document‰∏ä‰ΩøÁî®(Ê≥®ÊÑè‰∏çË¶Å‰ΩøÁî®ÁÆ≠Â§¥ÂáΩÊï∞ÔºåÂê¶ÂàôÊó†Ê≥ïËé∑Âèñthis)</p>
<pre><code class="language-js"> var animalSchema = new Schema({ name: String, type: String });
animalSchema.methods.findSimilarTypes = function(cb) {
    return this.model('Animal').find({ type: this.type }, cb);
};
//ÊàñËÄÖËøôÊ†∑ÂÜô
animalSchema.method('findSimilarTypes ', function () {})
animalSchema.method({findSimilarTypes : function () {}});
//Âú®Model‰∏ä‰ΩøÁî®
var Animal = mongoose.model('Animal', animalSchema);
var dog = new Animal({ type: 'dog' });
dog.findSimilarTypes(function(err, dogs) {
    console.log(dogs); // woof
});
</code></pre>
<p>Êàë‰ª¨ËøòÂèØ‰ª•Âú®schema‰∏äÂÆö‰πâ‰∏Ä‰∫õ<code>statics</code>ÔºåËØ•ÊñπÊ≥ïÂèØ‰ª•Âú®model‰∏ä‰ΩøÁî®Ôºö</p>
<pre><code class="language-js">animalSchema.statics.findByName = function(name, cb) {
    return this.find({ name: new RegExp(name, 'i') }, cb);
  };
var Animal = mongoose.model('Animal', animalSchema);
  Animal.findByName('fido', function(err, animals) {
    console.log(animals);
  });
</code></pre>
<p>Êàë‰ª¨ËøòÂèØ‰ª•‰∏∫Êü•ÊâæÂô®Â¢ûÂä†‰∏Ä‰∫õÈìæÂºèÂ∏ÆÂä©ÂáΩÊï∞</p>
<pre><code class="language-js"> animalSchema.query.byName = function(name) {
    return this.where({ name: new RegExp(name, 'i') });
  };
var Animal = mongoose.model('Animal', animalSchema);
  Animal.find().byName('fido').exec(function(err, animals) {
    console.log(animals);
  });
</code></pre>
<p>mongooseÈªòËÆ§‰ºö‰∏∫ÊØè‰∏™schemaÂª∫Á´ã‰∏Ä‰∏™Ëá™Âä®Á¥¢ÂºïÔºå‰∏çËøáÂú®Áîü‰∫ßÁéØÂ¢ÉÂª∫ËÆÆÂÖ≥ÊéâÔºåÊúâÂ¶Ç‰∏ãËøô‰∫õÊñπÊ≥ïÔºö</p>
<pre><code class="language-js"> mongoose.connect('mongodb://user:pass@localhost:port/database', { autoIndex: false });
  mongoose.createConnection('mongodb://user:pass@localhost:port/database', { autoIndex: false });
  animalSchema.set('autoIndex', false);
  new Schema({..}, { autoIndex: false });
</code></pre>
<p>ÊÇ®ËøòÂèØ‰ª•‰∏∫schemaËÆæÁΩÆËôöÊãüÁöÑÂ±ûÊÄßÔºåËØ•Â±ûÊÄß‰∏ç‰ºö‰øùÂ≠òÂú®Êï∞ÊçÆÂ∫ì‰∏≠Ôºå‰ΩÜÊòØÂú®‰Ω†ÂèñÂÄºËÆæÁΩÆÂÄºÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ÂàÜËß£ÊàñËÄÖÂêàÂπ∂Â±ûÊÄßÂÄºÔºö</p>
<pre><code class="language-js">var personSchema = new Schema({
    name: {
      first: String,
      last: String
    }
  });
  var Person = mongoose.model('Person', personSchema);
  var axl = new Person({
    name: { first: 'Axl', last: 'Rose' }
  });
personSchema.virtual('fullName').get(function () {
  return this.name.first + ' ' + this.name.last;
});
console.log(axl.fullName); // Axl Rose
</code></pre>
<p>Ê≥®ÊÑèË¶ÅÂØπËôöÊãüÂ±ûÊÄßËøõË°å<code>toJSON()</code> or<code>toObject()</code>ËΩ¨Êç¢Êó∂ÈúÄË¶Å‰º†ÈÄí<code>{ virtuals: true }</code>ÂèÇÊï∞ËøõÊù•ÊâçË°å„ÄÇ</p>
<p>‰Ω†ËøòÂèØ‰ª•‰ΩøÁî®<code>alias</code>‰∏∫Â±ûÊÄßÂêçËÆæÁΩÆÂà´Âêç</p>
<pre><code class="language-js">var personSchema = new Schema({
  n: {
    type: String,
    alias: 'name'
  }
})
var person = new Person({ name: 'Val' });
console.log(person); // { n: 'Val' }
console.log(person.toObject({ virtuals: true })); // { n: 'Val', name: 'Val' }
</code></pre>
<p>Ê≥®ÊÑèÂ¶ÇÊûúÊòØÂµåÂ•óÂ±ûÊÄßÔºåÈúÄË¶ÅËÆæÁΩÆÂµåÂ•óË∑ØÂæÑ</p>
<pre><code class="language-js">const parentSchema = new Schema({
  name: {
    f: {
      type: String,
      alias: 'name.first'
    }
  }
});
</code></pre>
<p>ÊÇ®ËøòÂèØ‰ª•‰∏∫schemaËÆæÁΩÆÈÄâÈ°πÔºåËØ≠Ê≥ïÂ¶Ç‰∏ãÔºö</p>
<pre><code class="language-js">new Schema({..}, options);
//ÊàñËÄÖ
var schema = new Schema({..});
schema.set(option, value);
</code></pre>
<p>ÂÆÉÊúâÂ¶Ç‰∏ãËøô‰∫õÈÄâÈ°πÔºö</p>
<ul>
<li><code>autoIndex</code>Â∏ÉÂ∞îÂÄºÔºåÊòØÂê¶ÂºÄÂêØËá™Âä®Á¥¢Âºï</li>
<li><code>bufferCommands</code>Â∏ÉÂ∞îÂÄºÔºåÂΩìËøûÊé•ÊåÇÊéâÈáçËøû‰πãÂâçÊòØÂê¶ÁºìÂÜ≤ÂëΩ‰ª§</li>
<li><code>capped</code>Êï∞ÂÄºÔºå‰ΩøÁî®Âõ∫ÂÆöÂ§ßÂ∞ècollection</li>
<li><code>collection</code>Â≠óÁ¨¶‰∏≤Ôºå‰∏∫collectionËÆæÁΩÆ‰∏çÂêåÁöÑÂêçÂ≠ó</li>
<li><code>id</code>Â∏ÉÂ∞îÂÄºÔºåÂÖ≥Èó≠ÈªòËÆ§ÁöÑËôöÊãüÂ±ûÊÄß<code>id</code>ÂÄºÔºàËøîÂõûÁöÑÂÖ∂ÂÆûÊòØ_idÔºâ</li>
<li><code>_id</code>Â∏ÉÂ∞îÂÄºÔºåÂÖ≥Èó≠<code>_id</code>ÂÄºÔºàÂ∞Ü‰ºöÂØºËá¥Êó†Ê≥ï‰øùÂ≠òÔºâ</li>
<li><code>minimize</code>Â∏ÉÂ∞îÂÄºÔºåËÆæ‰∏∫false‰ºö‰øùÂ≠òÁ©∫ÂØπË±°</li>
<li><code>read</code>ËÆæÁΩÆqueryÁöÑreadÁöÑ‰ºòÂÖàÁ∫ß</li>
<li><code>writeConcern</code><a href="https://docs.mongodb.com/manual/reference/write-concern/" target="_blank" rel="nofollow">Âú®schemaÁ∫ßÂà´ËÆæÁΩÆwrite concern</a></li>
<li><code>safe</code>ÈÅóÁïôapiÔºå‰∏éwriteConcernÁõ∏Âêå</li>
<li><code>shardKey</code>ËÆæÁΩÆÂàÜÁâákeyÂÄº</li>
<li><code>strict</code>Â∏ÉÂ∞îÂÄºÔºåËßÑÂÆöÂú®schema‰∏≠Ê≤°ÊúâÂÆö‰πâÁöÑkey‰∏ç‰ºöË¢´‰øùÂ≠ò</li>
<li><code>strictQuery</code>‰∏∫filterËÆæÁΩÆquery</li>
<li><code>toJSON</code>ËΩ¨Êç¢‰∏∫jsonÂØπË±°‰∏étoObjectÁõ∏ÂêåÔºå‰ΩÜÊòØÈúÄË¶ÅÊòæÁ§∫Ë∞ÉÁî®</li>
<li><code>toObject</code>ËΩ¨Êç¢‰∏∫JsonÂØπË±°</li>
</ul>
<pre><code class="language-js">var schema = new Schema({ name: String });
schema.path('name').get(function (v) {
  return v + ' is my name';
});
schema.set('toJSON', { getters: true, virtuals: false });
var M = mongoose.model('Person', schema);
var m = new M({ name: 'Max Headroom' });
schema.set('toObject', { getters: true });
console.log(m.toJSON());// { _id: 504e0cd7dd992d9be2f20b6f, name: 'Max Headroom is my name' }
console.log(m); // { _id: 504e0cd7dd992d9be2f20b6f, name: 'Max Headroom is my name' }
</code></pre>
<ul>
<li><code>typeKey</code>ÈªòËÆ§ÁöÑÔºåmongoose‰ºöÂ∞Ü<code>type</code>Â≠óÁ¨¶‰∏≤ÂΩìÂÅöMongooseÁöÑtypeËß£ÈáäÔºåÂ¶ÇÊûúÈúÄË¶ÅÂΩìÂÅöÂ±ûÊÄßËøõË°åËß£ÈáäÔºåÈúÄË¶ÅËÆæÁΩÆtypeKey</li>
</ul>
<pre><code class="language-js">var schema = new Schema({
  // Mongoose interpets this as 'loc is an object with 2 keys, type and coordinates'
  loc: { type: String, coordinates: [Number] },
  // Mongoose interprets this as 'name is a String'
  name: { $type: String }
}, { typeKey: '$type' }); // A '$type' key means this object is a type declaration
</code></pre>
<ul>
<li>validateBeforeSaveÊâãÂä®ÊéßÂà∂ÊòØÂê¶Âú®‰øùÂ≠ò‰πãÂâçËøõË°åÈ™åËØÅ</li>
</ul>
<pre><code class="language-js">var schema = new Schema({ name: String });
schema.set('validateBeforeSave', false);
</code></pre>
<ul>
<li><code>versionKey</code>Ëá™ÂÆö‰πâÁâàÊú¨ÊéßÂà∂</li>
<li><code>collation</code><a href="https://docs.mongodb.com/manual/reference/collation/" target="_blank" rel="nofollow">ËÆæÁΩÆÊ†°È™å</a></li>
<li><code>skipVersioning</code>ÂøΩÁï•ÁâàÊú¨ÁÆ°ÁêÜ</li>
<li><code>timestamps</code>ËÆæÁΩÆÊó∂Èó¥Êà≥ÔºåÈªòËÆ§‰∏∫createdAt ÂíåupdatedAt</li>
<li><code>useNestedStrict</code>ËÆæÁΩÆÂµåÂ•óschemaÁöÑÊõ¥Êñ∞ËßÑÂàô</li>
</ul>
<h2 id="ËøûÊé•">ËøûÊé•</h2>
<p>ÊÇ®ÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑËØ≠Ê≥ïÊù•ËøûÊé•mongodb:</p>
<pre><code class="language-js">mongoose.connect('mongodb://username:password@host:port/database?options...',options);
</code></pre>
<p>optionsÊúâ‰∏Ä‰∏ãÈÄâÈ°πÔºö</p>
<ul>
<li><code>bufferCommands</code></li>
<li><code>user/pass</code></li>
<li><code>autoIndex</code></li>
<li><code>dbName</code></li>
<li><code>autoReconnect</code></li>
<li><code>reconnectTries</code></li>
<li><code>reconnectInterval</code></li>
<li><code>promiseLibrary</code></li>
<li><code>poolSize</code></li>
<li><code>bufferMaxEntries</code></li>
<li><code>connectTimeoutMS</code></li>
<li><code>socketTimeoutMS</code></li>
</ul>
<h2 id="models">Models</h2>
<p>ModelsÊòØÁî®Êù•ÂàõÂª∫ÂíåËØªÂÜôÊï∞ÊçÆÂ∫ìÁöÑÔºåÂÆÉÁöÑ‰∏Ä‰∏™ÂÆû‰æãÂ∞±ÊòØdocument„ÄÇ</p>
<pre><code class="language-js">var Tank = mongoose.model('Tank', yourSchema);
//Á¨¨‰∏ÄÁßçÊñπÊ≥ï
var small = new Tank({ size: 'small' });
small.save(function (err) {
  if (err) return handleError(err);
  // saved!
});
// Á¨¨‰∫åÁßçÊñπÊ≥ï
Tank.create({ size: 'small' }, function (err, small) {
  if (err) return handleError(err);
  // saved!
});
// Á¨¨‰∏âÁßçÊñπÊ≥ï
Tank.insertMany([{ size: 'small' }], function(err) {

});
</code></pre>
<p>Ê≥®ÊÑèÊØè‰∏Ä‰∏™modelÈÉΩÊúâÂØπÂ∫îÁöÑËøûÊé•ÔºåÂ¶ÇÊûú‰ΩøÁî®ÁöÑÊòØ<code>mongoose.model()</code>,ÂàôÂØπÂ∫î<code>mongoose.connect('localhost', 'gettingstarted');</code>Â¶ÇÊûú‰ΩøÁî®ÁöÑÊòØËá™ÂÆö‰πâÁöÑËøûÊé•ÔºåÂàô‰ΩøÁî®</p>
<pre><code class="language-js">var connection = mongoose.createConnection('mongodb://localhost:27017/test');
var Tank = connection.model('Tank', yourSchema);
</code></pre>
<p>Â∏∏Áî®Êü•ËØ¢Êìç‰ΩúÔºö</p>
<ul>
<li><code>deleteMany()</code></li>
<li><code>deleteOne()</code></li>
<li><code>find()</code></li>
<li><code>findById()</code></li>
<li><code>findByIdAndDelete()</code></li>
<li><code>findByIdAndRemove()</code></li>
<li><code>findByIdAndUpdate()</code></li>
<li><code>findOne()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndRemove()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>replaceOne()</code></li>
<li><code>updateMany()</code></li>
<li><code>updateOne()</code></li>
</ul>
<p>Ëøô‰∫õÊñπÊ≥ïÈÉΩÊúâ‰∏§ÁßçÊñπÊ≥ïÔºå‰∏ÄÁßçÊòØÁõ¥Êé•‰ΩøÁî®ÂõûË∞ÉÂáΩÊï∞ÔºåÂè¶‰∏ÄÁßçÊòØ‰ΩøÁî®<code>.then()</code>ÈìæÂºèË∞ÉÁî®Ôºà‰∏çÂêå‰∫éÁúüÊ≠£ÁöÑpromiseÔºåmongooseËøîÂõûÁöÑÊü•ËØ¢‰∏çËÉΩ‰ΩøÁî®Â§öÊ¨°thenÔºåÂê¶Âàô‰ºöÊâßË°åÂ§öÊ¨°ÔºâÔºåÂΩìÊï∞ÊçÆÊîπÂèòÁöÑÊó∂ÂÄôÔºåÊÇ®ËøòÂèØ‰ª•‰ΩøÁî®<code>model.watch</code>Êù•ËøõË°åËßÇÂØüÔºö</p>
<pre><code class="language-js">async function run() {
  // Create a new mongoose model
  const personSchema = new mongoose.Schema({
    name: String
  });
  const Person = mongoose.model('Person', personSchema, 'Person');
  // Create a change stream. The 'change' event gets emitted when there's a
  // change in the database
  Person.watch().
    on('change', data =&gt; console.log(new Date(), data));
  // Insert a doc, will trigger the change stream handler above
  console.log(new Date(), 'Inserting doc');
  await Person.create({ name: 'Axl Rose' });
}
2018-05-11T15:05:35.467Z 'Inserting doc'
2018-05-11T15:05:35.487Z 'Inserted doc'
2018-05-11T15:05:35.491Z { _id: { _data: ... },
  operationType: 'insert',
  fullDocument: { _id: 5af5b13fe526027666c6bf83, name: 'Axl Rose', __v: 0 },
  ns: { db: 'test', coll: 'Person' },
  documentKey: { _id: 5af5b13fe526027666c6bf83 } }
</code></pre>
<p>ÊÇ®‰∏ç‰ªÖÂèØ‰ª•ÊääÊü•ËØ¢ÁöÑÊù°‰ª∂‰∏ÄÊ¨°ÊÄßÂÖ®ÈÉ®ÂÜôÂú®Êü•ËØ¢json‰∏≠ÔºåËøòÂèØ‰ª•‰ΩøÁî®ÈìæÂºèÊñπÂºè‰π¶ÂÜôÔºå‰∏ãÈù¢ÁöÑÂÜôÊ≥ïÈÉΩÊòØÁõ∏Á≠âÁöÑÔºö</p>
<pre><code class="language-js">Person.
  find({
    occupation: /host/,
    'name.last': 'Ghost',
    age: { $gt: 17, $lt: 66 },
    likes: { $in: ['vaporizing', 'talking'] }
  }).
  limit(10).
  sort({ occupation: -1 }).
  select({ name: 1, occupation: 1 }).
  exec(callback);
// Áõ∏Á≠âÁöÑÂÜôÊ≥ï
Person.
  find({ occupation: /host/ }).
  where('name.last').equals('Ghost').
  where('age').gt(17).lt(66).
  where('likes').in(['vaporizing', 'talking']).
  limit(10).
  sort('-occupation').
  select('name occupation').
  exec(callback);
</code></pre>
<p>ÊÇ®ËøòÂèØ‰ª•‰∏∫Êü•ËØ¢ÊñπÊ≥ïËÆæÁΩÆ‰∏Ä‰∫õÈí©Â≠êÂáΩÊï∞Ôºå‰ΩøÁî®<code>cursor()</code>Âç≥ÂèØÔºåÊúâ‰∏§ÁßçÊñπÊ≥ïÔºåÁ¨¨‰∏ÄÁßç‰ΩøÁî®streamË∞ÉÁî®ÔºåÁ¨¨‰∫åÁßç‰ΩøÁî®<code>next</code>ÊâãÂä®Ë∞ÉÁî®Ôºö</p>
<pre><code class="language-js">// There are 2 ways to use a cursor. First, as a stream:
Thing.
  find({ name: /^hello/ }).
  cursor().
  on('data', function(doc) { console.log(doc); }).
  on('end', function() { console.log('Done!'); });
// Or you can use `.next()` to manually get the next doc in the stream.
// `.next()` returns a promise, so you can use promises or callbacks.
var cursor = Thing.find({ name: /^hello/ }).cursor();
cursor.next(function(error, doc) {
  console.log(doc);
});
</code></pre>
<h2 id="subdocuments">subdocuments</h2>
<p>documents‰ª£Ë°®Â≠òÂÇ®Âú®mongodb‰∏≠ÁöÑÂÆûÈôÖÊï∞ÊçÆÔºåÊØè‰∏Ä‰∏™documentÈÉΩÊòØmodelÁöÑ‰∏Ä‰∏™ÂÆû‰æã„ÄÇsubdocumentsÂ∞±ÊòØÂµåÂ•óÂú®ÂÖ∂‰ªñdocuments‰∏≠ÁöÑÂ≠êÊñáÊ°£„ÄÇmongoose‰∏≠Êúâ‰∏§ÁßçÂ≠êÊñáÊ°£Á±ªÂûãÔºå‰∏ÄÁßçÊòØÊï∞ÁªÑÔºå‰∏ÄÁßçÊòØÂçï‰∏™ÊñáÊ°£Ôºö</p>
<pre><code class="language-js">var parentSchema = new Schema({
  // Array of subdocuments
  children: [childSchema],
  // Single nested subdocuments. Caveat: single nested subdocs only work
  // in mongoose &gt;= 4.2.0
  child: childSchema
});
</code></pre>
<p>subdocumentsÂíådocuments‰πãÈó¥ÁöÑ‰∏ªË¶Å‰∏çÂêåÂ∞±ÊòØÔºåsubdocuments‰∏çÂçïÁã¨‰øùÂ≠òÔºåÂè™Ë¶ÅÁà∂Á∫ßdocuments‰øùÂ≠ò‰∫ÜÔºåÂÆÉÂ∞±‰ºöË¢´‰øùÂ≠ò„ÄÇÂ≠êÊñáÊ°£ÁöÑ<code>pre('save')</code>Âíå<code>pre('validate')</code>‰ºöÂú®Áà∂ÊñáÊ°£ÁöÑ<code>pre('save')</code>‰πãÂâçÔºå<code>pre('validate')</code>‰πãÂêéÊâßË°å„ÄÇÊÇ®ÂèØ‰ª•‰ΩøÁî®<code>_id</code>Êü•ÊâæÂ≠êÊñáÊ°£Ôºö</p>
<pre><code class="language-js">var doc = parent.children.id(_id);
</code></pre>
<p>ÊÇ®ÂèØ‰ª•‰ΩøÁî®pushÔºåunshiftÔºåaddToSetÊù•ÂØπÂ≠êÊñáÊ°£Êï∞ÁªÑÊìç‰ΩúÔºåÊàñËÄÖÁõ¥Êé•‰ΩøÁî®createÊñπÊ≥ïÔºö</p>
<pre><code class="language-js">var Parent = mongoose.model('Parent');
var parent = new Parent;
// create a comment
parent.children.push({ name: 'Liesl' });
var subdoc = parent.children[0];
console.log(subdoc) // { _id: '501d86090d371bab2c0341c5', name: 'Liesl' }
subdoc.isNew; // true
parent.save(function (err) {
  if (err) return handleError(err)
  console.log('Success!');
});
//ÊàñËÄÖ
var newdoc = parent.children.create({ name: 'Aaron' });
</code></pre>
<p>ÂΩìÊÇ®ÊÉ≥Ë¶ÅÂà†Èô§Â≠êÊñáÊ°£Êó∂ÔºåÂèØ‰ª•‰ΩøÁî®<code>remove</code>ÊñπÊ≥ïÔºö</p>
<pre><code class="language-js">// Equivalent to `parent.children.pull(_id)`
parent.children.id(_id).remove();
// Equivalent to `parent.child = null`
parent.child.remove();
</code></pre>
<h2 id="È™åËØÅ">È™åËØÅ</h2>
<p>Âú®mongoose‰∏≠ÔºåÊï∞ÊçÆÁöÑÊØèÊ¨°Êìç‰ΩúÈÉΩÈúÄË¶ÅËøõË°åÈ™åËØÅÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Èò≤Ê≠¢‰∏Ä‰∫õÊÅ∂ÊÑèÊ≥®ÂÖ•Á≠âÂç±ÂÆ≥„ÄÇÈ™åËØÅÊòØÂú®schema‰∏≠ÂÆö‰πâÁöÑÔºå‰∏îÊòØmiddleware„ÄÇ</p>
<p>Mongoose‰∏≠Êúâ‰∏Ä‰∫õÂÜÖÁΩÆÁöÑÈ™åËØÅÂô®Ôºö</p>
<ul>
<li><code>required</code></li>
<li><code>Numbers</code>Êúâ<code>min</code>Âíå<code>max</code>È™åËØÅÂô®</li>
<li><code>Strings</code>Êúâ<code>enum</code>, <code>match</code>, <code>maxlength</code> and <code>minlength</code>È™åËØÅÂô®</li>
</ul>
<p>Â¶ÇÊûúÊÉ≥Ë¶ÅËá™ÂÆö‰πâ‰Ω†Ëá™Â∑±ÁöÑÈ™åËØÅÂô®ÔºåÂèØ‰ª•Âä†ÂÖ•<code>validate</code>Â±ûÊÄßÔºö</p>
<pre><code class="language-js">var userSchema = new Schema({
  phone: {
    type: String,
    validate: {
      validator: function(v) {
        return /\d{3}-\d{3}-\d{4}/.test(v);
      },
      message: '{VALUE} is not a valid phone number!'
    },
    required: [true, 'User phone number required']
  }
});
var User = db.model('user', userSchema);
var user = new User();
var error;
user.phone = '555.0123';
error = user.validateSync();
assert.equal(error.errors['phone'].message,
  '555.0123 is not a valid phone number!');
</code></pre>
<p>ÊÇ®ËøòÊúâÂèØ‰ª•ËÆæÁΩÆÂºÇÊ≠•ÁöÑÈ™åËØÅÂô®Ôºö</p>
<pre><code class="language-js">var userSchema = new Schema({
  name: {
    type: String,
    // You can also make a validator async by returning a promise. If you
    // return a promise, do **not** specify the `isAsync` option.
    validate: function(v) {
      return new Promise(function(resolve, reject) {
        setTimeout(function() {
          resolve(false);
        }, 5);
      });
    }
  },
  phone: {
    type: String,
    validate: {
      isAsync: true,
      validator: function(v, cb) {
        setTimeout(function() {
          var phoneRegex = /\d{3}-\d{3}-\d{4}/;
          var msg = v + ' is not a valid phone number!';
          // First argument is a boolean, whether validator succeeded
          // 2nd argument is an optional error message override
          cb(phoneRegex.test(v), msg);
        }, 5);
      },
      // Default error message, overridden by 2nd argument to `cb()` above
      message: 'Default error message'
    },
    required: [true, 'User phone number required']
  }
});
</code></pre>
<p>Â¶ÇÊûúÊÉ≥Ë¶ÅÂú®<code>update()</code>ÊàñËÄÖ<code>findOneAndUpdate()</code>‰∏≠ÂºÄÂêØÈ™åËØÅÁöÑËØùÔºåÈúÄË¶ÅËÆæÁΩÆ<code>runValidators</code>:</p>
<pre><code class="language-js">var toySchema = new Schema({
  color: String,
  name: String
});
var Toy = db.model('Toys', toySchema);
Toy.schema.path('color').validate(function (value) {
  return /blue|green|white|red|orange|periwinkle/i.test(value);
}, 'Invalid color');
var opts = { runValidators: true };
Toy.update({}, { color: 'bacon' }, opts, function (err) {
  assert.equal(err.errors.color.message,
    'Invalid color');
});
</code></pre>
<p><code>update</code>È™åËØÅÂô®Âíå<code>document</code>È™åËØÅÂô®ÊúâÂá†ÁÇπÂå∫Âà´Ôºö</p>
<ul>
<li>updateÈ™åËØÅÂô®thisÊú™ÂÆö‰πâ,documentÈ™åËØÅÂô®thisÊåáÂêëËØ•documentÔºå‰∏çËøá‰Ω†ÂèØ‰ª•Âú®updateÈ™åËØÅÂô®‰∏äÈÄöËøáËÆæÁΩÆcontextËÆæÁΩÆthisÊåáÂêëËØ•Êü•ËØ¢</li>
<li>updateÈ™åËØÅÂô®Âè™È™åËØÅÂØπÂ∫îÁöÑË∑ØÂæÑ</li>
<li>updateÈ™åËØÅÂô®Âè™Âú®‰∏Ä‰∫õÊìç‰ΩúÁ¨¶Êó∂ÂÄôËøêË°åÔºå<code>$set</code>Ôºå<code>$unset</code>Ôºå<code>$push (&gt;= 4.8.0)</code>Ôºå<code>$addToSet (&gt;= 4.8.0)</code>Ôºå<code>$pull (&gt;= 4.12.0)</code>Ôºå<code>$pullAll (&gt;= 4.12.0)</code></li>
</ul>
<h2 id="middleware">Middleware</h2>
<p>MongooseÊúâ4Áßç‰∏≠Èó¥‰ª∂Ôºö</p>
<ul>
<li>document ‰∏≠Èó¥‰ª∂Ôºö
<ul>
<li><code>init</code></li>
<li><code>validate</code></li>
<li><code>save</code></li>
<li><code>remove</code></li>
</ul>
</li>
<li>model ‰∏≠Èó¥‰ª∂Ôºö
<ul>
<li><code>count</code></li>
<li><code>find</code></li>
<li><code>findOne</code></li>
<li><code>findOneAndRemove</code></li>
<li><code>findOneAndUpdate</code></li>
<li><code>update</code></li>
<li><code>updateOne</code></li>
<li><code>updateMany</code></li>
</ul>
</li>
<li><code>aggregate</code> ‰∏≠Èó¥‰ª∂Ôºö
<ul>
<li><code>aggregate</code></li>
</ul>
</li>
<li><code>query</code> ‰∏≠Èó¥‰ª∂Ôºö
<ul>
<li><code>insertMany</code></li>
</ul>
</li>
</ul>
<p>Êúâ‰∏§ÁßçÈí©Â≠êÂáΩÊï∞Ôºå‰∏ÄÁßçÊòØ‰∏≤Ë°åÁöÑÔºå‰∏ÄÁßçÊòØÂπ∂Ë°åÁöÑÔºåÂú®‰∏≤Ë°å‰∏≠Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî®<code>next</code>Êù•ÊâßË°å‰∏ã‰∏ÄÊ≠•ÔºåÊàñËÄÖËøîÂõû‰∏Ä‰∏™promiseÂáΩÊï∞ÔºåpreË°®Á§∫‰πãÂâçÔºåpostË°®Á§∫‰πãÂêéÔºö</p>
<pre><code class="language-js">var schema = new Schema(..);
schema.pre('save', function(next) {
  // do stuff
  next();
});
schema.pre('save', function() {
  return doStuff().
    then(() =&gt; doMoreStuff());
});
// Or, in Node.js &gt;= 7.6.0:
schema.pre('save', async function() {
  await doStuff();
  await doMoreStuff();
});
</code></pre>
<p>Âπ∂Ë°åÁöÑÊèê‰æõ‰∫ÜÊõ¥Âä†ÁªÜÁ≤íÂ∫¶ÁöÑÊµÅÊéßÂà∂Ôºö</p>
<pre><code class="language-js">var schema = new Schema(..);
// Á¨¨‰∫å‰∏™ÂèÇÊï∞ËÆæÁΩÆ‰∏∫trueË°®Á§∫Âπ∂Ë°å
schema.pre('save', true, function(next, done) {
  // calling next kicks off the next middleware in parallel
  next();
  setTimeout(done, 100);
});
</code></pre>
<p>Ê≥®ÊÑèpostÂíåpre‰∏ç‰ºöÂú®update(), findOneAndUpdate()‰∏äÊâßË°å„ÄÇ</p>
<h2 id="populate">Populate</h2>
<p>populationÊòØ‰∏Ä‰∏™Ëá™Âä®Êäädocument‰∏≠ÁöÑË∑ØÂæÑËΩ¨Êç¢‰∏∫ÂØπÂ∫îÁöÑdocumentÁöÑËøáÁ®ãÔºå‰ΩøÁî®<code>ref</code>ÊåáÂêëÂç≥ÂèØÔºö</p>
<pre><code class="language-js">var mongoose = require('mongoose');
var Schema = mongoose.Schema;
var personSchema = Schema({
  _id: Schema.Types.ObjectId,
  name: String,
  age: Number,
  stories: [{ type: Schema.Types.ObjectId, ref: 'Story' }]
});
var storySchema = Schema({
  author: { type: Schema.Types.ObjectId, ref: 'Person' },
  title: String,
  fans: [{ type: Schema.Types.ObjectId, ref: 'Person' }]
});
var Story = mongoose.model('Story', storySchema);
var Person = mongoose.model('Person', personSchema);
</code></pre>
<p>Ê≥®ÊÑèObjectId, Number, String, and BufferÈÉΩÊòØÂêàÊ≥ïÁöÑrefÁ±ªÂûãÔºå‰ΩÜÊòØÂØπ‰∫éÊñ∞ÊâãÊúÄÂ•ΩÂè™‰ΩøÁî®ObjectId„ÄÇ</p>
<p>ÁÑ∂ÂêéÂú®Êü•ËØ¢ÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•<code>populate</code>Â∞ÜÂØπÂ∫îÁöÑÊï∞ÊçÆÊï¥ÂêàËøõÊù•Ôºö</p>
<pre><code class="language-js">Story.
  findOne({ title: 'Casino Royale' }).
  populate('author').
  exec(function (err, story) {
    if (err) return handleError(err);
    console.log('The author is %s', story.author.name);
    // prints &quot;The author is Ian Fleming&quot;
  });
</code></pre>
<p>Â¶ÇÊûúÂè™ÊÉ≥Êï¥Âêà‰∏Ä‰∫õÂüüÁöÑËØùÔºåÂèØ‰ª•Âú®populateÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰∏≠ÂÜôÂÖ•Ë¶ÅÈÄâÊã©ÁöÑÂ≠óÊÆµÔºåÂ¶ÇÊûúÊòØÂ§ö‰∏™ÁöÑËØùÂèØ‰ª•Áî®Á©∫Ê†ºÂàÜÂºÄÔºö</p>
<pre><code class="language-js">Story.
  findOne({ title: /casino royale/i }).
  populate('author', 'name'). // only return the Persons name
  exec(function (err, story) {})
</code></pre>
<p>Â¶ÇÊûúÊÉ≥Ë¶ÅÊï¥ÂêàÂ§ö‰∏™refÁöÑËØùÔºåÂèØ‰ª•ËøûÁª≠Ë∞ÉÁî®(Â¶ÇÊûúÂØπÂêå‰∏Ä‰∏™refËÆæÁΩÆÂ§ö‰∏™ÔºåÂàôÂè™ÊúâÊúÄÂêé‰∏Ä‰∏™ÁîüÊïà)</p>
<pre><code class="language-js">Story.
  find(...).
  populate('fans').
  populate('author').
  exec();
</code></pre>
<p>Â¶ÇÊûúÊÉ≥Ë¶ÅÊõ¥Á≤æÁªÜÂåñÁöÑÊéßÂà∂ÔºåËøòÂèØ‰ª•Áªôpopulate‰º†ÂÖ•‰∏Ä‰∏™ÂØπË±°Ôºö</p>
<pre><code class="language-js">Story.
  find(...).
  populate({
    path: 'fans',
    match: { age: { $gte: 21 }},
    // Explicitly exclude `_id`, see http://bit.ly/2aEfTdB
    select: 'name -_id',
    options: { limit: 5 }
  }).
  exec();
</code></pre>
<p>Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅpopulateÊñáÊ°£‰∏ãÈù¢ÁöÑpopulateÂØπË±°ÔºåÂàôÔºö</p>
<pre><code class="language-js">User.
  findOne({ name: 'Val' }).
  populate({
    path: 'friends',
    // Get friends of friends - populate the 'friends' array for every friend
    populate: { path: 'friends' }
  });
</code></pre>
<p>Ë∑®Êï∞ÊçÆÂ∫ìpopulate:</p>
<pre><code class="language-js">var eventSchema = new Schema({
  name: String,
  // The id of the corresponding conversation
  // Notice there's no ref here!
  conversation: ObjectId
});
var conversationSchema = new Schema({
  numMessages: Number
});
var db1 = mongoose.createConnection('localhost:27000/db1');
var db2 = mongoose.createConnection('localhost:27001/db2');
var Event = db1.model('Event', eventSchema);
var Conversation = db2.model('Conversation', conversationSchema);
Event.
  find().
  populate({ path: 'conversation', model: Conversation }).
  exec(function(error, docs) { /* ... */ });
</code></pre>
<p>ÊÇ®ËøòÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ<code>refPath</code>Êù•ËÆæÁΩÆÂä®ÊÄÅÁöÑref:</p>
<pre><code class="language-js">var userSchema = new Schema({
  name: String,
  connections: [{
    kind: String,
    item: { type: ObjectId, refPath: 'connections.kind' }
  }]
});
</code></pre>
<p>Âè™Âú®_id‰∏≠ËÆæÁΩÆref‰∏çÊòØÊúÄÂ•ΩÁöÑÈÄâÊã©ÔºåÊÇ®ËøòÂèØ‰ª•Âú®virtuals‰∏≠ËøõË°åËÆæÁΩÆÔºö</p>
<pre><code class="language-js">var PersonSchema = new Schema({
  name: String,
  band: String
});
var BandSchema = new Schema({
  name: String
});
BandSchema.virtual('members', {
  ref: 'Person', // The model to use
  localField: 'name', // ÊâæÂà∞Êú¨Âú∞Â≠óÊÆµ `localField`‰∏éÂØπÂ∫îmodelÂ≠óÊÆµ`foreignField`ÂÄºÁõ∏Á≠âÁöÑdocument
  foreignField: 'band', 
  // If `justOne` is true, 'members' will be a single doc as opposed to
  // an array. `justOne` is false by default.
  justOne: false
});
</code></pre>
<p>Ê≥®ÊÑè<code>toJSON()</code>‰∏çÂåÖÂê´Âú®virtuals ‰∏≠ÔºåÊâÄ‰ª•ÈúÄË¶ÅÊâãÂä®ËÆæÁΩÆÔºö</p>
<pre><code class="language-js">var BandSchema = new Schema({
  name: String
}, { toJSON: { virtuals: true } });
</code></pre>
<p>ÁÑ∂Âêé‰ΩøÁî®,Ê≥®ÊÑè<code>foreignField</code>ÂøÖÈ°ªÂåÖÂê´Âú®populate‰∏≠Ôºö</p>
<pre><code class="language-js">Band.
  find({}).
  populate({ path: 'members', select: 'name band' }).
  exec(function(error, bands) {
    // Works, foreign field `band` is selected
  });
</code></pre>
<p>ÊÇ®ËøòÂèØ‰ª•Âú®‰∏≠Èó¥‰ª∂‰∏≠‰ΩøÁî®populate:</p>
<pre><code class="language-js">MySchema.pre('find', function() {
  this.populate('user');
});
MySchema.post('find', async function(docs) {
  for (let doc of docs) {
    if (doc.isPublic) {
      await doc.populate('user').execPopulate();
    }
  }
});
MySchema.post('save', function(doc, next) {
  doc.populate('user').execPopulate(function() {
    next();
  });
});
</code></pre>
<h2 id="discriminators">Discriminators</h2>
<p>Discriminators ÊòØ‰∏Ä‰∏™schemaÁöÑÁªßÊâøÊú∫Âà∂ÔºåÂèØ‰ª•‰ΩøÂæó‰Ω†Êã•ÊúâÂ§ö‰∏™models‰ΩøÁî®‰∫ÜÈáçÂè†ÁöÑschemaÂú®Âêå‰∏Ä‰∏™collection‰∏ãÈù¢„ÄÇ‰æãÂ¶Ç‰Ω†ÂèØ‰ª•‰ΩøÁî®<code>model.discriminator()</code>Êù•Êï¥Âêà‰∏Ä‰∏™Âü∫Á°ÄÁöÑschemaÂíå‰∏Ä‰∏™Discriminator schemaÔºö</p>
<pre><code class="language-js">var options = {discriminatorKey: 'kind'};
var eventSchema = new mongoose.Schema({time: Date}, options);
var Event = mongoose.model('Event', eventSchema);
// ClickedLinkEvent is a special type of Event that has
// a URL.
var ClickedLinkEvent = Event.discriminator('ClickedLink',
  new mongoose.Schema({url: String}, options));
// When you create a generic event, it can't have a URL field...
var genericEvent = new Event({time: Date.now(), url: 'google.com'});
assert.ok(!genericEvent.url);
// But a ClickedLinkEvent can
var clickedEvent =
  new ClickedLinkEvent({time: Date.now(), url: 'google.com'});
</code></pre>
<p>mongooseÂàÜËæ®‰∏çÂêåÁöÑDiscriminators ÊòØÈÄöËøá<code>__t</code>Êù•Âå∫ÂàÜÁöÑÔºåËÄå‰∏îDiscriminators ÈÉΩÂèØ‰ª•ÂæàÊô∫ËÉΩÂú∞ÈÄöËøá<code>find()</code>, <code>count()</code>, <code>aggregate()</code>Êù•ÊâæÂà∞Êï∞ÈáèÔºö</p>
<pre><code class="language-js">var event1 = new Event({time: Date.now()});
var event2 = new ClickedLinkEvent({time: Date.now(), url: 'google.com'});
var event3 = new SignedUpEvent({time: Date.now(), user: 'testuser'});
var save = function (doc, callback) {
  doc.save(function (error, doc) {
    callback(error, doc);
  });
};
async.map([event1, event2, event3], save, function (error) {
  ClickedLinkEvent.find({}, function (error, docs) {
    assert.equal(docs.length, 1);
    assert.equal(docs[0]._id.toString(), event2._id.toString());
    assert.equal(docs[0].url, 'google.com');
  });
});
</code></pre>
<p>Discriminators ÂèØ‰ª•‰ΩøÁî®Âü∫Á°ÄÁöÑschemaÁöÑ‰∏≠Èó¥‰ª∂Ôºå‰ΩÜÊòØ‰Ω†‰πüÂèØ‰ª•‰∏∫ÂÆÉÊ∑ªÂä†Ëá™Â∑±ÁöÑ‰∏≠Èó¥‰ª∂ËÄå‰∏çÂΩ±ÂìçÂü∫Á°ÄÁöÑschema:</p>
<pre><code class="language-js">var options = {discriminatorKey: 'kind'};
var eventSchema = new mongoose.Schema({time: Date}, options);
var eventSchemaCalls = 0;
eventSchema.pre('validate', function (next) {
  ++eventSchemaCalls;
  next();
});
var Event = mongoose.model('GenericEvent', eventSchema);
var clickedLinkSchema = new mongoose.Schema({url: String}, options);
var clickedSchemaCalls = 0;
clickedLinkSchema.pre('validate', function (next) {
  ++clickedSchemaCalls;
  next();
});
var ClickedLinkEvent = Event.discriminator('ClickedLinkEvent',
  clickedLinkSchema);
var event1 = new ClickedLinkEvent();
event1.validate(function() {
  assert.equal(eventSchemaCalls, 1);
  assert.equal(clickedSchemaCalls, 1);
  var generic = new Event();
  generic.validate(function() {
    assert.equal(eventSchemaCalls, 2);
    assert.equal(clickedSchemaCalls, 1);
  });
});
</code></pre>
<p>ÂΩì‰Ω†‰ΩøÁî®<code>Model.create()</code>Ëá™Âä®ÂàõÂª∫Êó∂Ôºåmongoose‰ºöËá™Âä®‰∏∫ÊÇ®ÈÄâÊã©ÈÄÇÂêàÁöÑDiscriminatorËøõË°åÂàõÂª∫Ôºö</p>
<pre><code class="language-js">var Schema = mongoose.Schema;
var shapeSchema = new Schema({
  name: String
}, { discriminatorKey: 'kind' });
var Shape = db.model('Shape', shapeSchema);
var Circle = Shape.discriminator('Circle',
  new Schema({ radius: Number }));
var Square = Shape.discriminator('Square',
  new Schema({ side: Number }));
var shapes = [
  { name: 'Test' },
  { kind: 'Circle', radius: 5 },
  { kind: 'Square', side: 10 }
];
Shape.create(shapes, function(error, shapes) {
  assert.ifError(error);
  assert.ok(shapes[0] instanceof Shape);
  assert.ok(shapes[1] instanceof Circle);
  assert.equal(shapes[1].radius, 5);
  assert.ok(shapes[2] instanceof Square);
  assert.equal(shapes[2].side, 10);
});
</code></pre>
<h2 id="Â∏∏Áî®api">Â∏∏Áî®API</h2>
<ul>
<li>
<p>Model</p>
<ul>
<li><code>Model.count()</code>ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑÊñáÊ°£Êï∞ÈáèÔºåÂ∑≤ÁªèÂ∫üÂºÉ</li>
<li><code>Model.countDocuments()</code>ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑÊñáÊ°£Êï∞Èáè</li>
<li><code>Model.create()</code>ÂàõÂª∫‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÊñáÊ°£Ôºå<code>MyModel.create(docs)</code>Á≠âÂêå‰∫éÂ§ö‰∏™<code>new MyModel(doc).save()</code></li>
<li><code>Model.deleteMany()</code>Âà†Èô§Â§ö‰∏™</li>
<li><code>Model.deleteOne()</code>Âà†Èô§‰∏Ä‰∏™</li>
<li><code>Model.distinct()</code>Êü•ÊâæÊâÄÊúâÊñáÊ°£‰∏≠Êüê‰∏™Â≠óÊÆµÁöÑ‰∏çÈáçÂ§çÂÄºÔºåËøîÂõûÂéªÈáçÂêéÁöÑÂ≠óÊÆµÊâÄÊúâÂÄº</li>
<li><code>Model.find()</code></li>
<li><code>Model.findById()</code></li>
<li><code>Model.findByIdAndDelete()</code></li>
<li><code>Model.findByIdAndRemove()</code></li>
<li><code>Model.findByIdAndUpdate()</code></li>
<li><code>Model.findOne()</code></li>
<li><code>Model.findOneAndDelete()</code></li>
<li><code>Model.findOneAndRemove()</code></li>
<li><code>Model.findOneAndUpdate()</code></li>
<li><code>Model.insertMany()</code></li>
<li><code>Model.populate()</code></li>
<li><code>Model.prototype.$where()</code>ÂàõÂª∫‰∏Ä‰∏™Êü•ËØ¢</li>
</ul>
<pre><code class="language-js">Blog.$where('this.username.indexOf(&quot;val&quot;) !== -1').exec();
</code></pre>
<ul>
<li><code>Model.prototype.remove()</code></li>
<li><code>Model.prototype.save()</code></li>
<li><code>Model.remove()</code></li>
<li><code>Model.replaceOne()</code></li>
<li><code>Model.update()</code>Êõ¥Êñ∞ÊñáÊ°£‰ΩÜÊòØ‰∏çËøîÂõûËØ•Êï∞ÊçÆ</li>
<li><code>Model.updateMany()</code></li>
<li><code>Model.updateOne()</code></li>
<li><code>Model.where()</code>Êü•ËØ¢</li>
</ul>
<pre><code class="language-js">User.where('age').gte(21).lte(65).exec(callback);
</code></pre>
</li>
<li>
<p>Document</p>
<ul>
<li><code>Document.prototype.$ignore()</code>‰∏çÂÖÅËÆ∏È™åËØÅÂô®Ôºå‰∏ç‰øùÁïôÊîπÂä®Êüê‰∏™Â≠óÊÆµ</li>
<li><code>Document.prototype.$isDefault()</code>Âà§Êñ≠Êüê‰∏™Â≠óÊÆµÊòØÂê¶ËÆæÁΩÆÈªòËÆ§ÂÄº</li>
<li><code>Document.prototype.$isDeleted()</code>Âà§Êñ≠ÊòØÂê¶ÁßªÈô§</li>
<li><code>Document.prototype.depopulate()</code>ËøõË°åpopulateÁöÑÈÄÜËøêÁÆó</li>
<li><code>Document.prototype.get()</code>ÂèñÂÄº</li>
<li><code>Document.prototype.invalidate()</code>Â∞ÜÂ≠óÊÆµÊ†áËÆ∞‰∏∫‰∏çÂêàÊ†ºÔºåËß¶ÂèëÈ™åËØÅÂ§±Ë¥•</li>
<li><code>Document.prototype.populate()</code>Êï¥Âêàref</li>
<li><code>Document.prototype.populated()</code>ËøîÂõûÊï¥ÂêàÁöÑrefÁöÑ<code>_id</code></li>
<li><code>Document.prototype.save()</code>‰øùÂ≠ò</li>
<li><code>Document.prototype.set()</code>ËÆæÁΩÆÂÄº</li>
<li><code>Document.prototype.toJSON()</code>ËΩ¨Êç¢‰∏∫json</li>
<li><code>Document.prototype.toObject()</code>ËΩ¨Êç¢‰∏∫plainObject</li>
<li><code>Document.prototype.update()</code>Êõ¥Êñ∞ÊñáÊ°£</li>
<li><code>Document.prototype.validate()</code>ÊâßË°åÈ™åËØÅÂô®</li>
<li><code>Document.prototype.validateSync()</code>ÂêåÊ≠•ÊâßË°åÈ™åËØÅÂô®</li>
</ul>
</li>
<li>
<p>Query</p>
<ul>
<li><code>Query.prototype.$where()</code>ÊâßË°å‰∏Ä‰∏™ÂáΩÊï∞ÊàñË°®ËææÂºèÊü•ËØ¢</li>
</ul>
</li>
</ul>
<pre><code class="language-js">query.$where('this.comments.length === 10 || this.name.length === 5')
// or
query.$where(function () {
  return this.comments.length === 10 || this.name.length === 5;
})
</code></pre>
<ul>
<li><code>Query.prototype.countDocuments()</code>Êü•ËØ¢Êï∞Èáè</li>
<li><code>Query.prototype.deleteMany()</code></li>
<li><code>Query.prototype.deleteOne()</code></li>
<li><code>Query.prototype.distinct()</code></li>
<li><code>Query.prototype.elemMatch()</code>ÂµåÂ•óÊü•ËØ¢‰ΩøÁî®ÔºåÊõø‰ª£findÊü•ËØ¢ÂµåÂ•óÂ≠óÊÆµÂÜô<code>path.path</code></li>
<li><code>Query.prototype.equals()</code>Êü•ËØ¢Êó∂ÂÄôÂÄºÁ≠â‰∫é</li>
<li><code>Query.prototype.exec()</code>ÊâßË°åÊü•ËØ¢</li>
<li><code>Query.prototype.exists()</code>Âà§Êñ≠ÊòØÂê¶Â≠òÂú®Êüê‰∏™Â≠óÊÆµ</li>
<li><code>Query.prototype.find()</code></li>
<li><code>Query.prototype.findOne()</code></li>
<li><code>Query.prototype.findOneAndDelete()</code></li>
<li><code>Query.prototype.findOneAndRemove()</code></li>
<li><code>Query.prototype.findOneAndUpdate()</code></li>
<li><code>Query.prototype.getQuery()</code>ËøîÂõûÊü•ËØ¢Êù°‰ª∂Ôºå‰ΩøÁî®jsonÊ†ºÂºèË°®Á§∫Âá∫Êù•</li>
<li><code>Query.prototype.getUpdate()</code>ËøîÂõûÊõ¥Êñ∞Êù°‰ª∂Ôºå‰ΩøÁî®jsonÊ†ºÂºèË°®Á§∫</li>
<li><code>Query.prototype.gt()</code></li>
<li><code>Query.prototype.gte()</code></li>
<li><code>Query.prototype.lean()</code>Êü•ËØ¢ÂêéÁöÑÁªìÊûúÂ¶ÇÊûú‰ΩøÁî®‰∫ÜleanÂ∞Ü‰∏çÂÜçÊúâsaveÁ≠âdocÁöÑÊñπÊ≥ï</li>
<li><code>Query.prototype.limit()</code></li>
<li><code>Query.prototype.lt()</code></li>
<li><code>Query.prototype.lte()</code></li>
<li><code>Query.prototype.nor()</code>ÈÉΩ‰∏çÊòØ</li>
</ul>
<pre><code class="language-js">query.nor([{ color: 'green' }, { status: 'ok' }])
</code></pre>
<ul>
<li><code>Query.prototype.or()</code>‰∏§‰∏™‰∏≠‰∏Ä‰∏™</li>
</ul>
<pre><code class="language-js">query.or([{ color: 'red' }, { status: 'emergency' }])
</code></pre>
<ul>
<li><code>Query.prototype.populate()</code></li>
<li><code>Query.prototype.regex()</code>Ê≠£ÂàôÊü•ËØ¢</li>
<li><code>Query.prototype.remove()</code></li>
<li><code>Query.prototype.select()</code>ÈÄâÊã©ÈúÄË¶ÅÂ±ïÁ§∫ÊàñËÄÖÊéíÈô§ÁöÑÂ≠óÊÆµÔºåÂ¶ÇÊûúÊòØÂ≠óÁ¨¶ÂèØ‰ª•Áî®<code>+</code>Ë°®Á§∫ÂåÖÂê´Ôºå<code>-</code>Ë°®Á§∫ÊéíÈô§ÔºåÂØπË±°ÂèØ‰ª•Áî®<code>1</code>Ë°®Á§∫ÂåÖÂê´Ôºå<code>0</code>Ë°®Á§∫ÊéíÈô§</li>
</ul>
<pre><code class="language-js">query.select('a b');
query.select('-c -d');
query.select({ a: 1, b: 1 });
query.select({ c: 0, d: 0 });
</code></pre>
<ul>
<li><code>Query.prototype.set()</code></li>
<li><code>Query.prototype.setOptions()</code></li>
<li><code>Query.prototype.skip()</code></li>
<li><code>Query.prototype.slice()</code></li>
<li><code>Query.prototype.sort()</code>ÊéíÂ∫èÔºåÂΩì‰Ω†‰ΩøÁî®objectÊó∂ÔºåÂèØ‰ª•ÊåáÂÆö<code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>ÔºåÂ¶ÇÊûúÊòØÂ≠óÁ¨¶‰∏≤ÔºåÈªòËÆ§ÊòØÂçáÂ∫èÔºå‰ΩøÁî®<code>-</code>Êù•ÈôçÂ∫èÔºö</li>
</ul>
<pre><code class="language-js">// sort by &quot;field&quot; ascending and &quot;test&quot; descending
query.sort({ field: 'asc', test: -1 });
// equivalent
query.sort('field -test');
</code></pre>
<ul>
<li><code>Query.prototype.then()</code></li>
<li><code>Query.prototype.update()</code></li>
<li><code>Query.prototype.updateMany()</code></li>
<li><code>Query.prototype.updateOne()</code></li>
<li><code>Query.prototype.where()</code></li>
</ul>
<h2 id="ÂÆû‰æã">ÂÆû‰æã</h2>
<p>ÂàÜÈ°µÔºö</p>
<pre><code class="language-js">model.find(queryCondition).limit(limit).skip(limit*page).exec(function(err, results){
      ...
    });
</code></pre>
<h2 id="ÂèÇËÄÉËµÑÊñô">ÂèÇËÄÉËµÑÊñô</h2>
<ul>
<li><a href="http://mongoosejs.com/docs/" target="_blank" rel="nofollow">http://mongoosejs.com/docs/</a></li>
</ul>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">‰∏ã‰∏ÄÁØá</div>
                                <a href="https://huxinmin.github.io/post/consolelog-ge-shi-hua-shu-chu-xiang-jie/">
                                    <h3 class="post-title">
                                        console.log Ê†ºÂºèÂåñËæìÂá∫ËØ¶Ëß£
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- ËøîÂõûÈ°∂ÈÉ® -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#why-mongoose">why mongoose?</a></li>
<li><a href="#%E7%AE%80%E4%BB%8B">ÁÆÄ‰ªã</a></li>
<li><a href="#%E5%AE%89%E8%A3%85">ÂÆâË£Ö</a></li>
<li><a href="#schemas">Schemas</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5">ËøûÊé•</a></li>
<li><a href="#models">Models</a></li>
<li><a href="#subdocuments">subdocuments</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81">È™åËØÅ</a></li>
<li><a href="#middleware">Middleware</a></li>
<li><a href="#populate">Populate</a></li>
<li><a href="#discriminators">Discriminators</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8api">Â∏∏Áî®API</a></li>
<li><a href="#%E5%AE%9E%E4%BE%8B">ÂÆû‰æã</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">ÂèÇËÄÉËµÑÊñô</a></li>
</ul>
</li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://huxinmin.github.io" target="_blank">ËÉ°Êñ∞ÊïèÁöÑ‰∏™‰∫∫ÂçöÂÆ¢</a></p>
</footer>


    <!-- jQuery -->
<script src="https://huxinmin.github.io/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://huxinmin.github.io/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://huxinmin.github.io/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://huxinmin.github.io/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://huxinmin.github.io/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://huxinmin.github.io/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://huxinmin.github.io/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // ‰ª£Á†ÅÈ´ò‰∫Æ
    hljs.initHighlightingOnLoad();

    // img ÊáíÂä†ËΩΩ
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // ÊáíÂä†ËΩΩÂä®Áîª
            threshold: 180  // Âú®ÂõæÁâáË∑ùÁ¶ªÂ±èÂπï180pxÊó∂ÊèêÂâçËΩΩÂÖ•
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // ÁõÆÂΩï
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
        var allImg = $("img");
        allImg.on("contextmenu", function () {
            return false;
        });
        allImg.on("dragstart", function () {
            return false;
        });
    
</script>




</body>
</html>
